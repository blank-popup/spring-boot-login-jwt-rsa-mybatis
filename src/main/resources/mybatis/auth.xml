<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.loginJwtRSA.security.MapperAuth">
    <select id="selectUserDetailsByUsername" parameterType="String" resultType="com.example.loginJwtRSA.security.UserDetailsCustom">
        SELECT
            id,
            username,
            password
        FROM aha_user
        WHERE username = #{username}
    </select>

    <select id="selectUserDetailsById" parameterType="Long" resultType="com.example.loginJwtRSA.security.UserDetailsCustom">
        SELECT
            id,
            username,
            password
        FROM aha_user
        WHERE id = #{id}
    </select>

    <select id="selectRole" resultType="com.example.loginJwtRSA.security.ModelRole">
        SELECT
            id,
            name
        FROM aha_role
    </select>

    <insert id="insertUserRole" parameterType="com.example.loginJwtRSA.security.ModelUserRole">
        INSERT INTO aha_user_role (
            id_user,
            id_role
        )
        VALUES (
            #{idUser},
            #{idRole}
        )
    </insert>

    <select id="selectRolesByUsername" parameterType="String" resultType="String">
        SELECT
            ar.name
        FROM aha_user au
        JOIN aha_user_role aur
        ON aur.id_user = au.id
        JOIN aha_role ar
        ON ar.id = aur.id_role
        WHERE au.username = #{username}
    </select>

    <select id="selectRolesById" parameterType="Long" resultType="String">
        SELECT
            ar.name
        FROM aha_user_role aur
        JOIN aha_role ar
        ON aur.id_role = ar.id
        WHERE aur.id_user = #{id}
    </select>

    <insert id="insertUser" parameterType="com.example.loginJwtRSA.security.RequestSignUp">
        INSERT INTO aha_user (
            username,
            password
        )
        VALUES (
            #{username},
            #{password}
        )
    </insert>

    <insert id="createUserApiKey" parameterType="com.example.loginJwtRSA.security.ModelApiKey">
        INSERT aha_api_key (
            id,
            api_key,
            expire_at
        )
        VALUES (
            #{id},
            #{apiKey},
            #{expireAt}
        )
    </insert>

    <select id="getApiKeyByApiKey" parameterType="String" resultType="com.example.loginJwtRSA.security.ModelApiKey">
        SELECT
            id,
            api_key,
            expire_at,
            created_at,
            updated_at
        FROM aha_api_key aak
        WHERE api_key = #{apiKey}
    </select>
</mapper>
